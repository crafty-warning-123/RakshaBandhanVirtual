<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- WhatsApp Link Preview -->
  <meta property="og:title" content="🎉 रक्षा बंधन की शुभकामनाएं! 🎉">
  <meta property="og:description" content="No Distance Too Big for Rakhi! 💌 With Love from Radhika & Rajat">
  <meta property="og:image"
    content="https://crafty-warning-123.github.io/RakshaBandhanVirtualCelebration/attached_assets/Graphic_AA.png">
  <meta property="og:url" content="https://crafty-warning-123.github.io/RakshaBandhanVirtualCelebration/">
  <meta property="og:type" content="website">

  <title>Happy Raksha Bandhan</title>
  <link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(45deg, #8e24aa 0%, #9c27b0 25%, #8e24aa 50%, #9c27b0 100%);
      /* background: linear-gradient(45deg, #8e24aa 0%, #ff9800 25%, #ff7043 50%, #9c27b0 100%); */
      background-size: 100% 100%;
      animation: gradientShift 8s ease infinite;
      font-family: 'Baloo 2', cursive;
      margin: 0;
      overflow-x: hidden;
      position: relative;
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    .container {
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      margin-top: 2rem;
      position: relative;
      overflow: hidden;
    }

    .title {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 800;
      color: #8e24aa;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
      animation: dramaticZoom 2s ease-out;
      margin-bottom: 1rem;
    }

    @keyframes dramaticZoom {
      0% {
        transform: scale(0.3) rotate(-10deg);
        opacity: 0;
      }

      50% {
        transform: scale(1.2) rotate(5deg);
      }

      100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    .subtitle {
      text-align: center;
      font-size: 1.3rem;
      color: #ff9800;
      font-weight: 700;
      animation: slideInFromBottom 2s ease-out 0.5s both;
      margin-bottom: 2rem;
    }

    @keyframes slideInFromBottom {
      0% {
        transform: translateY(50px);
        opacity: 0;
      }

      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .question {
      display: none;
      animation: bounceIn 0.8s ease-out forwards;
      position: relative;
    }

    .question.active {
      display: block;
    }

    @keyframes bounceIn {
      0% {
        transform: scale(0.3) translateY(-100px);
        opacity: 0;
      }

      50% {
        transform: scale(1.1) translateY(10px);
      }

      100% {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    .question h3 {
      font-size: 1.8rem;
      color: #9c27b0;
      text-align: center;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .dual-input-container {
      display: flex;
      gap: 2rem;
      margin-bottom: 1.5rem;
    }

    .input-section {
      flex: 1;
      text-align: center;
    }

    .input-section h4 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      color: #9c27b0;
      font-weight: bold;
    }

    .rc-section h4 {
      color: #e91e63;
    }

    .rs-section h4 {
      color: #2196f3;
    }

    .input-section input {
      font-size: 1.2rem;
      padding: 1rem;
      border: 3px solid #ff4081;
      border-radius: 15px;
      background: linear-gradient(45deg, #fff, #fce4ec);
      transition: all 0.3s ease;
      width: 100%;
      box-sizing: border-box;
    }

    .rc-section input {
      border-color: #e91e63;
      background: linear-gradient(45deg, #fff, #fce4ec);
    }

    .rs-section input {
      border-color: #2196f3;
      background: linear-gradient(45deg, #fff, #e3f2fd);
    }

    .input-section input:focus {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(233, 30, 99, 0.3);
    }

    .rc-section input:focus {
      border-color: #c2185b;
      box-shadow: 0 0 20px rgba(233, 30, 99, 0.3);
    }

    .rs-section input:focus {
      border-color: #1976d2;
      box-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
    }

    .check-btn {
      background: linear-gradient(45deg, #9c27b0, #ff9800);
      color: white;
      font-weight: bold;
      padding: 1rem 2rem;
      border: none;
      border-radius: 25px;
      margin-top: 1.5rem;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .check-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 10px 25px rgba(156, 39, 176, 0.4);
    }

    .check-btn:before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .check-btn:hover:before {
      left: 100%;
    }

    .play-btn {
      background: linear-gradient(45deg, #9c27b0, #ff9800);
      color: white;
      font-weight: bold;
      padding: 1.5rem 3rem;
      border: none;
      border-radius: 30px;
      margin-top: 1rem;
      font-size: 1.5rem;
      cursor: pointer;
      display: block;
      margin-left: auto;
      margin-right: auto;
      animation: pulse 2s infinite;
      box-shadow: 0 10px 30px rgba(156, 39, 176, 0.4);
    }

    .music-btn {
      background: linear-gradient(45deg, #9c27b0, #ff9800);
      color: white;
      font-weight: bold;
      padding: 1rem 2rem;      
      border: none;
      border-radius: 25px;      
      margin: 1rem auto;      
      font-size: 1.1rem;      
      cursor: pointer;
      display: block;
      margin-left: auto;
      margin-right: auto;
      animation: pulse 2s infinite;
      box-shadow: 0 10px 30px rgba(156, 39, 176, 0.4);
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    .rakhi-choice {
      text-align: center;
      padding: 2rem;
    }

    .dual-rakhi-container {
      display: flex;
      flex-direction: column;
      /* Arrange rakhis vertically */
      align-items: center;
      /* Center items horizontally */
      gap: 3rem;
      justify-content: center;
      margin-top: 2rem;
    }

    .rakhi-section {
      flex: 1;
      text-align: center;
    }

    .rakhi-section h4 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
      color: #9c27b0;
      font-weight: bold;
    }

    .rc-rakhi h4 {
      color: #e91e63;
    }

    .rs-rakhi h4 {
      color: #2196f3;
    }

    .self-rakhi h4 {
      color: #9c27b0;
    }

    .rakhi-section img {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      margin: 1rem 0;
      cursor: pointer;
      transition: all 0.5s ease;
      border: 4px solid transparent;
      position: relative;
    }

    .rakhi-section img:hover {
      transform: scale(1.3) rotate(360deg);
      border-color: #9c27b0;
      box-shadow: 0 0 30px rgba(156, 39, 176, 0.6);
    }

    .rakhi-section img.selected {
      border: 6px solid #4caf50;
      box-shadow: 0 0 25px rgba(76, 175, 80, 0.8);
      transform: scale(1.1);
    }

    .rakhi-section img.selected:hover {
      border-color: #4caf50;
      box-shadow: 0 0 35px rgba(76, 175, 80, 0.9);
    }

    .feedback-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(45deg, #ffeb3b, #ffc107);
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      font-size: 1.3rem;
      font-weight: bold;
      color: #e65100;
      text-align: center;
      animation: popIn 0.5s ease-out;
      display: none;
      max-width: 400px;
    }

    @keyframes popIn {
      0% {
        transform: translate(-50%, -50%) scale(0.3);
        opacity: 0;
      }

      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #ff4081;
      animation: confettiFall 3s linear infinite;
      will-change: transform, opacity;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(0vh) rotate(0deg);
        opacity: 1;
      }

      100% {
        transform: translateY(200vh) rotate(720deg);
        opacity: 0;
      }
    }

    .confettiFromLine {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #ff4081;
      animation: confettiFallFromLine 3s linear infinite;
      will-change: transform, opacity;
    }

    @keyframes confettiFallFromLine {
      0% {
        transform: translateY(0vh) rotate(0deg);
        opacity: 1;
      }

      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .sparkle {
      position: absolute;
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, #fff, #ff4081);
      border-radius: 50%;
      animation: sparkle 2s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes sparkle {

      0%,
      100% {
        opacity: 0;
        transform: scale(0);
      }

      50% {
        opacity: 1;
        transform: scale(1);
      }
    }

    #final-msg {
      display: none;
      font-size: 1.3rem;
      text-align: center;
      margin-top: 2rem;
      color: #4e342e;
      animation: heartBeat 2s ease-in-out infinite;
    }

    @keyframes heartBeat {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #ffcdd2;
      border-radius: 10px;
      margin: 1rem 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(45deg, #9c27b0, #ff9800);
      border-radius: 10px;
      transition: width 0.8s ease;
      width: 0%;
    }

    .emoji-burst {
      position: absolute;
      font-size: 2rem;
      animation: emojiBurst 2s ease-out forwards;
      pointer-events: none;
    }

    @keyframes emojiBurst {
      0% {
        transform: scale(0) rotate(0deg);
        opacity: 1;
      }

      50% {
        transform: scale(1.5) rotate(180deg);
        opacity: 0.8;
      }

      100% {
        transform: scale(0.5) rotate(360deg);
        opacity: 0;
      }
    }

    .footer {
      text-align: center;
      margin-top: 1rem;
      margin-bottom: 1rem;
      font-style: italic;
      color: white;
      font-size: 1.1rem;
      animation: glow 4s ease-in-out infinite alternate;      
    }

    @keyframes glow {
      from {
        text-shadow: 0 0 5px white;
      }

      to {
        text-shadow: 0 0 20px white, 0 0 30px #ff9800;
      }
    }

    .correct-feedback {
      background: linear-gradient(45deg, #4caf50, #66bb6a) !important;
      color: white !important;
    }

    .wrong-feedback {
      background: linear-gradient(45deg, #f44336, #ef5350) !important;
      color: white !important;
    }

    .reveal-section {
      margin-top: 2rem;
      padding: 2rem;
      background: linear-gradient(45deg, #e3f2fd, #f3e5f5);
      border-radius: 15px;
      border: 3px solid #9c27b0;
    }

    .reveal-btn {
      background: linear-gradient(45deg, #9c27b0, #673ab7);
      color: white;
      font-weight: bold;
      padding: 1rem 2rem;
      border: none;
      border-radius: 25px;
      margin: 1rem auto;
      ;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: block;
    }

    .reveal-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 25px rgba(156, 39, 176, 0.4);
    }

    .skip-btn {
      background: linear-gradient(45deg, #607d8b, #455a64);
      color: white;
      font-weight: bold;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 20px;
      margin: 1rem 0 0 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .skip-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(96, 125, 139, 0.4);
    }

    .button-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .button-container .check-btn {
      margin: 0;
    }

    .button-container .skip-btn {
      margin: 0;
    }

    .answers-list {
      margin-top: 2rem;
      text-align: left;
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .answer-item {
      margin: 1rem 0;
      padding: 1rem;
      background: linear-gradient(45deg, #fff3e0, #fce4ec);
      border-radius: 10px;
      border-left: 4px solid #ff4081;
    }

    .answer-item h4 {
      color: #8e24aa;
      margin-bottom: 0.5rem;
    }

    .answer-item p {
      color: #5e35b1;
      font-weight: bold;
      margin: 0;
    }

    .dual-answers {
      display: flex;
      gap: 2rem;
    }

    .answer-section {
      flex: 1;
    }

    .rc-answers {
      border-left-color: #2196f3;
    }

    .rs-answers {
      border-left-color: #ff9800;
    }

    .final-result {
      display: flex;
      gap: 2rem;
      margin-top: 2rem;
    }

    .result-section {
      flex: 1;
      text-align: center;
    }

    .result-section h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .rc-result h3 {
      color: #e91e63;
    }

    .rs-result h3 {
      color: #2196f3;
    }

    .result-section img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid;
      margin: 1rem 0;
    }

    .rc-result img {
      border-color: #e91e63;
    }

    .rs-result img {
      border-color: #2196f3;
    }

    .self-result h3 {
      color: #9c27b0;
    }

    .self-result img {
      border-color: #9c27b0;
    }

    .tying-image {
      width: 250px !important;
      height: auto !important;
      border-radius: 15px !important;
      margin: 1rem 0 !important;
    }

    .gender-btn {
      font-size: 2rem;
      padding: 0.8rem 1.2rem;
      margin: 0.5rem;
      border: none;
      border-radius: 15px;
      background: linear-gradient(45deg, #9c27b0, #ff9800);
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
      /* Add this line to shrink width */
      width: 150px;
      text-align: center;
    }

    .gender-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 20px rgba(156, 39, 176, 0.4);
    }

    .gender-btn.selected-gender {
      box-shadow: 0 0 15px 5px rgba(76, 175, 80, 0.6);
      border: 3px solid #4caf50;
    }
  </style>
</head>

<body>
  <main class="container">
    <h1 id="maintitle" class="title">🎉 रक्षा बंधन की शुभकामनाएं! 🎉</h1>
    <p id="mainsubtitle" class="subtitle">No Distance Too Big for Rakhi!<br>💌 With Love from Radhika & Rajat</p>

    <form id="userForm" style="text-align: center; margin-bottom: 2rem; animation: slideInFromBottom 1s ease-out;">
      <div id="rakhiThali" style="text-align: center; margin-bottom: 3rem;">
        <img src="../attached_assets/Graphic_Rakhi.png" alt="Rakhi Thali"
          style="max-width: 90%; height: auto; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.3);">
      </div>
      <p
        style="text-align:center; font-size:1.3rem; color:#ff9800; font-weight:700; animation:slideInFromBottom 2s ease-out 0.5s both; margin-bottom:0.5rem;">
        ( ... scroll for more ... )<br> <br>But before the awwws begin…<br>Let’s test how well you know us! 🤪
        <br>Complete the quiz to unlock your Rakhi
        moment! 🎉<br>(Promise, it’s worth it!)<br> <br>
      </p>
      <p style="margin-bottom: 0.5rem; font-weight: bold; color: #9c27b0;">About you:</p>
      <input type="text" id="userName" placeholder="तुम्हारा नाम / Your name ✍️"
        style="margin-bottom: 0.25rem; font-size: 1.2rem; padding: 1rem; border: 3px solid #ff4081; border-radius: 15px; background: linear-gradient(45deg, #fff, #fce4ec); display: inline-block;" />

      <div id="genderButtons" style="margin-top: 0.25rem; display: flex; justify-content: center; gap: 1rem;">
        <button class="gender-btn" type="button" data-gender="female">👧</button>
        <button class="gender-btn" type="button" data-gender="male">👦</button>
      </div>

      <button id="submitUserInfo" class="play-btn" type="submit" disabled
        style="margin-top: 2.5rem; display: inline-block;">Let's Go 🚀</button>
    </form>

    <div id="musicplayer" style="text-align: center; margin-top:0rem; display: none;">
      <p style="text-align: center; font-weight: bold; color: #8e24aa; margin-top:0rem; margin-bottom:0.5rem;">
        Would you like some music?</p>
      <div
        style="position: relative; padding-top: 56.25%; max-width: 90%; margin: auto; margin-top:0rem; margin-bottom:0rem;">
        <iframe
          src="https://www.youtube-nocookie.com/embed/videoseries?si=hulTmcR5WXOPBsCY&amp;list=PLnOeAhpf-Q3v7tLc71CMAXnWKLgduAT8s"
          title="YouTube video player" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      </div>
      <p style="text-align: center; font-weight: bold; color: #8e24aa; margin-top:0.5rem; margin-bottom:0rem">
        Hit play before starting the quiz!</p>
    </div>

    <button id="startDramaBtn" class="play-btn" onclick="startQuiz()" style="display: none;">Start the Quiz!
      🎉🎭</button>

    <div id="quiz" style="display: none;">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <p id="progress" style="text-align: center; font-weight: bold; color: #8e24aa;"></p>

      <div class="question" id="q1">
        <h3>🧁 What is their favorite dessert?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a1" placeholder="Think hard, detective! 🤔">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a1" placeholder="Think hard, detective! 🤔">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q1','q2')">Submit your dessert guess 🍰</button>
          <button class="skip-btn" onclick="skipToNext('q1','q2')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" style="visibility: hidden;">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q2">
        <h3>📚 What subject did they hate in school/university?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a2" placeholder="Well! that is not easy to guess 😤">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a2" placeholder="Well! that is not easy to guess 😤">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q2','q3')">Reveal the subject drama! 📚💥</button>
          <button class="skip-btn" onclick="skipToNext('q2','q3')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q2','q1')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q3">
        <h3>🎬 Which movie can they watch over and over?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a3" placeholder="There are many! Guess any one!🎭">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a3" placeholder="There are many! Guess any one!🎭">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q3','q4')">Lock in the movie 🎬🎯</button>
          <button class="skip-btn" onclick="skipToNext('q3','q4')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q3','q2')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q4">
        <h3>🍕 What's their go-to comfort food?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a4" placeholder="What do I always talk fondly of? 🤤">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a4" placeholder="What do I always talk fondly of? 🤤">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q4','q5')">Check comfort food guess 😋</button>
          <button class="skip-btn" onclick="skipToNext('q4','q5')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q4','q3')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q5">
        <h3>🕺💃 Their favorite actor or actress growing up was?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a5" placeholder="Ohho! Majedar question hai ye! 🎤">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a5" placeholder="Ohho! Majedar question hai ye! 🎤">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q5','q6')">Guess locked! Let's see 🎭🔐</button>
          <button class="skip-btn" onclick="skipToNext('q5','q6')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q5','q4')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q6">
        <h3>🌈 Their most used emoji is?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a6" placeholder="Look around my chats for clues! 🧠">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a6" placeholder="Look around my chats for clues! 🧠">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q6','q7')">Drop the emoji bomb! 💣😂</button>
          <button class="skip-btn" onclick="skipToNext('q6','q7')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q6','q5')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q7">
        <h3>🏃‍♀️ What's their secret talent?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a7" placeholder="Keep going! 😎">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a7" placeholder="Keep going! 😎">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q7','q8')">Talent reveal? Hit it! 🎤🕺</button>
          <button class="skip-btn" onclick="skipToNext('q7','q8')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q7','q6')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q8">
        <h3>🧘 What do they do to feel better when stressed or sad?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a8" placeholder="Where do I waste all my time? 🤭">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a8" placeholder="Where do I waste all my time? 🤭">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q8','q9')">Let's heal with that guess 🧘‍♀️💖</button>
          <button class="skip-btn" onclick="skipToNext('q8','q9')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q8','q7')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q9">
        <h3>🎵 A song that always lifts their mood is?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a9" placeholder="Think about my personality! 🎉">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a9" placeholder="Think about my personality! 🎉">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q9','q10')">Music vibes incoming! 🎵🌈</button>
          <button class="skip-btn" onclick="skipToNext('q9','q10')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q9','q8')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="q10">
        <h3>⚡ If they could teleport anywhere right now, where would they go?</h3>
        <div class="dual-input-container">
          <div class="input-section rc-section">
            <h4>Make your guess for Radhika</h4>
            <input type="text" id="rc_a10" placeholder="This one is super easy! 🦉">
          </div>
          <div class="input-section rs-section">
            <h4>Make your guess for Rajat</h4>
            <input type="text" id="rs_a10" placeholder="This one is super easy! 🦉">
          </div>
        </div>
        <div class="button-container">
          <button class="check-btn" onclick="next('q10','rakhi')">Teleport that answer! ✈️🧭</button>
          <button class="skip-btn" onclick="skipToNext('q10','rakhi')">Skip or Continue to Next Question ➡️</button>
          <button class="skip-btn" onclick="skipToNext('q10','q9')">Go Back to Previous Question ⬅️</button>
          <button class="skip-btn" onclick="skipToEnd()">Skip to the End of the Quiz 🚀</button>
        </div>
      </div>

      <div class="question" id="rakhi">
        <h3>चलो, अब सबके लिए राखी पसंद करो! 🎁</h3>
        <div class="dual-rakhi-container">
          <div class="rakhi-section rc-rakhi">
            <h4>पहले राधिका के लिए राखी बताओ, कौन सी अच्छी है?</h4>
            <div>
              <img src="../attached_assets/Rakhi1.webp" onclick="selectRakhi('rc', this, 'Rakhi1')"
                alt="Lumba Rakhi with Kundan">
              <img src="../attached_assets/Rakhi2.webp" onclick="selectRakhi('rc', this, 'Rakhi2')"
                alt="Lumba Rakhi with Meenakari">
              <img src="../attached_assets/Rakhi3.webp" onclick="selectRakhi('rc', this, 'Rakhi3')"
                alt="Lumba Rakhi with Golden Lotus">
              <img src="../attached_assets/Rakhi4.webp" onclick="selectRakhi('rc', this, 'Rakhi4')"
                alt="Lumba Rakhi with Eye and Tassel">
            </div>
          </div>
          <div class="rakhi-section rs-rakhi">
            <h4>और अब बताओ, रजत के लिए कौन सी राखी बढ़िया लग रही है?</h4>
            <div>
              <img src="../attached_assets/Rakhi5.webp" onclick="selectRakhi('rs', this, 'Rakhi5')"
                alt="Rakhi thread with Kundan">
              <img src="../attached_assets/Rakhi6.webp" onclick="selectRakhi('rs', this, 'Rakhi6')"
                alt="Rakhi thread with Meenakari">
              <img src="../attached_assets/Rakhi7.webp" onclick="selectRakhi('rs', this, 'Rakhi7')"
                alt="Rakhi thread with Golden Lotus">
              <img src="../attached_assets/Rakhi8.webp" onclick="selectRakhi('rs', this, 'Rakhi8')"
                alt="Rakhi thread with Peacock">
            </div>
          </div>
          <div class="rakhi-section self-rakhi">
            <h4>अब खुद के लिए भी एक राखी पसंद करो।</h4>
            <div id="self-rakhi-images">
              <img src="../attached_assets/Rakhi1.webp" onclick="selectRakhi('self', this, 'Rakhi1')"
                alt="Lumba Rakhi with Kundan">
              <img src="../attached_assets/Rakhi2.webp" onclick="selectRakhi('self', this, 'Rakhi2')"
                alt="Lumba Rakhi with Meenakari">
              <img src="../attached_assets/Rakhi3.webp" onclick="selectRakhi('self', this, 'Rakhi3')"
                alt="Lumba Rakhi with Golden Lotus">
              <img src="../attached_assets/Rakhi4.webp" onclick="selectRakhi('self', this, 'Rakhi4')"
                alt="Lumba Rakhi with Eye and Tassel">
              <img src="../attached_assets/Rakhi5.webp" onclick="selectRakhi('self', this, 'Rakhi5')"
                alt="Rakhi thread with Kundan">
              <img src="../attached_assets/Rakhi6.webp" onclick="selectRakhi('self', this, 'Rakhi6')"
                alt="Rakhi thread with Meenakari">
              <img src="../attached_assets/Rakhi7.webp" onclick="selectRakhi('self', this, 'Rakhi7')"
                alt="Rakhi thread with Golden Lotus">
              <img src="../attached_assets/Rakhi8.webp" onclick="selectRakhi('self', this, 'Rakhi8')"
                alt="Rakhi thread with Peacock">
            </div>
          </div>
        </div>
        <div id="final-msg"></div>
        <div style="text-align: center; margin-top: 2rem;">
          <button class="check-btn" onclick="forceContinue()">All Set! Let's continue 🎊</button>
        </div>
      </div>

      <div class="question" id="final-slide">
        <!-- This will be filled dynamically with rakhi tying content -->
      </div>

    </div>
  </main>

  <footer class="footer">
    <p style="color: white; font-weight: bold; margin: 0; line-height: 1.5; animation: pulse 2s infinite;">💛 jojwi productions 💛</p>
    <p style="color: white; margin: 0; line-height: 1.5;">Made with love, chaos, and way too much emotion!</p>
  </footer>

  <div id="feedbackPopup" class="feedback-popup"></div>

  <script>
    let userName = '';
    let userGender = '';

    const genderButtons = document.querySelectorAll('.gender-btn');
    const submitBtn = document.getElementById('submitUserInfo');

    genderButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Remove highlight from other buttons
        genderButtons.forEach(btn => btn.classList.remove('selected-gender'));
        // Highlight this one
        button.classList.add('selected-gender');
        userGender = button.getAttribute('data-gender');
        checkFormReady();
      });
    });

    document.getElementById('userName').addEventListener('input', checkFormReady);

    function checkFormReady() {
      if (userGender) {
        submitBtn.disabled = false;
      } else {
        submitBtn.disabled = true;
      }
    }

    document.getElementById('userForm').addEventListener('submit', function (e) {
      e.preventDefault();
      userName = document.getElementById('userName').value.trim();

      if (userGender === 'male') {
        const rakhiContainer = document.getElementById('self-rakhi-images');
        if (rakhiContainer) {
          const rakhiImgs = Array.from(rakhiContainer.children);
          const reordered = [
            rakhiImgs[4], rakhiImgs[5], rakhiImgs[6], rakhiImgs[7],
            rakhiImgs[0], rakhiImgs[1], rakhiImgs[2], rakhiImgs[3]
          ];
          rakhiContainer.innerHTML = '';
          reordered.forEach(img => rakhiContainer.appendChild(img));
        }
      }

      // Hide form, show start button
      document.getElementById('userForm').style.display = 'none';
      document.getElementById('musicplayer').style.display = 'block';
      document.getElementById('startDramaBtn').style.display = 'block';
      // Scroll to top of page
      window.scrollTo({top: 0, behavior: 'smooth'});
    });

    const progress = document.getElementById('progress');
    const progressFill = document.getElementById('progressFill');
    const quiz = document.getElementById('quiz');
    const feedbackPopup = document.getElementById('feedbackPopup');

    const wrongFeedbacks = [
      "Really? That's your detective work? 😂",
      "Oh please! You clearly don't know them AT ALL! 🙄",
      "Seriously? Did you even TRY? 🤦‍♀️",
      "Wrong! Try harder next time! 😒",
      "Nope! Better luck with the next question! 🙃"
    ];

    const correctFeedbacks = [
      "Perfect! Bravo! You are more observant than I think! 👏",
      "Wow! Good job! You actually know them! 😍",
      "Excellent detective work! You got it right! 🕵️‍♂️",
      "Amazing! You're paying attention! I'm impressed! 💯",
      "Spot on! You really DO know them well! ❤️"
    ];

    // All possible correct answers for each question (RC: A1-A10, RS: B1-B10)
    const correctAnswers = {
      'q1': {
        'rc': ['Kheer', 'Choorma', 'Gulab Jamun', 'Ice Cream', 'Shrikhand', 'Imarti', 'Moong dal ka halwa', 'Kalakand', 'Nankhatai', 'Khir'],
        'rs': ['Kheer', 'Jalebi', 'Gajar ka halwa', 'Aam', 'Mango', 'Khir', 'Gajar halwa', '___', '___', '___']
      },
      'q2': {
        'rc': ['Social Science', 'Social Studies', 'History', 'Sociology', '___', '___', '___', '___', '___', '___'],
        'rs': ['Chemistry', 'Social Science', 'Social Studies', '___', '___', '___', '___', '___', '___', '___']
      },
      'q3': {
        'rc': ['Guru', 'Vivah', 'Hera Pheri', 'Jannat', 'K3G', 'Kabhi Khushi Kabhi Gam', 'Delhi Belly', 'Dil Chahta Hai', 'Jab We Met', 'Nayak'],
        'rs': ['Hera Pheri', 'Delhi Belly', 'Gangs of Wasseypur', 'Munna Bhai M.B.B.S.', 'Nayak', 'Swades', 'Padosan', 'Krantiveer', 'Khosla Ka Ghosla!', 'Pyaasa']
      },
      'q4': {
        'rc': ['Poori', 'Puri', 'Poori ke sath poori', 'Subah poori sham poori', 'Khub saari poori', 'Kheer Poori', 'Aaloo Poori', 'Halwa Poori', 'Methi Poori', 'Palak Poori'],
        'rs': ['Bhindi', 'Aaloo', 'Taroi', 'Rajjo ki rasoi', 'Home made', 'Self cooked', '___', '___', '___', '___']
      },
      'q5': {
        'rc': ['Govinda', 'Karishma Kapoor', '___', '___', '___', '___', '___', '___', '___', '___'],
        'rs': ['Aishwarya Rai', 'Akshay Kumar', '___', '___', '___', '___', '___', '___', '___', '___']
      },
      'q6': {
        'rc': ['Sparkle', '✨', '🤭', '😂', '😭', '___', '___', '___', '___', '___'],
        'rs': ['Laughing', '😂', '😅', '😛', '😆', '___', '___', '___', '___', '___']
      },
      'q7': {
        'rc': ['Bata dungi to secret kaise rahega?', 'Pass', 'Pata nahi', 'Skip', 'Idk', 'Kya malum', 'No idea', '___', '___', '___'],
        'rs': ['Tum hi batao bhai koi ho to?', 'Pass', 'Pata nahi', 'Skip', 'Idk', 'Kya malum', 'No idea', '___', '___', '___']
      },
      'q8': {
        'rc': ['Sleep', 'Painting', 'Embroidery', 'Drawing', 'Writing', 'Reading', 'Reels', 'Craft', 'Paint', 'Scroll reels'],
        'rs': ['Listen to music', 'Lie down', 'Play chess', '420', 'purani aadatein', 'old habits', 'purani aadat', 'Music', 'Rest', 'Chess']
      },
      'q9': {
        'rc': ['Chaiyya chaiyya', 'Kahi aag lage lag jaye', 'Ek pal ka jeena', 'Tunak tunak', 'Jihne mera dil luteya', 'Ay hairathe', 'Gud se meetha ishq', 'Jalla sain', 'Chunri chunri', 'Jag Jeondeyan De Mele'],
        'rs': ['Jag Jeondeyan De Mele', 'Mera piya ghar aaya', 'Ek pal ka jeena', 'Yun hi chala chal', '___', '___', '___', '___', '___', '___']
      },
      'q10': {
        'rc': ['Home', 'India', 'Udaipur', 'Fateh Sagar', 'Gangaur Ghat', 'Bilaspur', 'Minocha Colony', '___', '___', '___'],
        'rs': ['Home', 'Anywhere in the universe', '___', '___', '___', '___', '___', '___', '___', '___']
      }
    };

    const questionTexts = {
      'q1': '🧁 What is their favorite dessert?',
      'q2': '📚 What subject did they hate in school/university?',
      'q3': '🎬 Which movie can they watch over and over?',
      'q4': '🍕 What\'s their go-to comfort food?',
      'q5': '🕺💃 Their favorite actor or actress growing up was?',
      'q6': '🌈 Their most used emoji is?',
      'q7': '🏃‍♀️ What\'s their secret talent?',
      'q8': '🧘 What do they do to feel better when stressed or sad?',
      'q9': '🎵 A song that always lifts their mood is?',
      'q10': '⚡ If they could teleport anywhere right now, where would they go?'
    };

    let selectedRakhis = {
      'rc': null,
      'rs': null,
      'self': null
    };

    function startQuiz() {
      document.getElementById('musicplayer').style.display = 'none';
      document.getElementById('startDramaBtn').style.display = 'none';
      quiz.style.display = 'block';
      createConfetti();
      showQuestion('q1', 1);
      // Scroll to top of question
      const progress_scroll = document.getElementById('progressFill');
      const startY_scroll = progress_scroll.getBoundingClientRect().top + window.scrollY - 0;
      window.scrollTo({top: startY_scroll, behavior: 'smooth'});
    }

    function showQuestion(id, num) {
      document.getElementById(id).classList.add('active');

      // Only show progress text for the first 10 questions
      if (id.startsWith('q')) {
        progress.innerText = `Question ${num} of 10 - You got this! 💪
        There could be more than one correct answer. Guess any one.`;
        progress.style.color = '#9c27b0';
        progressFill.style.width = `${(num / 10) * 100}%`;
      } else {
        progress.innerText = '';
        progressFill.style.width = '100%';
      }

      // Add ta-da effect
      createEmojiBurst('🎉', '🎊', '💥');
    }

    function next(currentId, nextId) {
      const rcAnswer = document.getElementById(`rc_${currentId.replace('q', 'a')}`).value.trim();
      const rsAnswer = document.getElementById(`rs_${currentId.replace('q', 'a')}`).value.trim();

      // Check if answers are empty
      if (!rcAnswer && !rsAnswer) {
        const emptyBothFeedbacks = [
          "Seriously? You're just clicking buttons now? 🤦‍♀️",
          "Did you fall asleep? Enter SOMETHING! 😴",
          "Hello? Anyone home? Type some answers! 🏠👋",
          "Are we playing 'guess the blank space'? 🤔",
          "Even a random guess is better than nothing! 🎲"
        ];
        showFeedback(getRandomFeedback(emptyBothFeedbacks), false);
        return;
      }

      if (!rcAnswer) {
        const emptyRcFeedbacks = [
          "Radhika's feelings are hurt! You forgot about her! 💔",
          "Radhika is waiting... and waiting... and waiting... ⏰",
          "One guess down, one to go! Don't leave Radhika hanging! 🤷‍♀️",
          "Radhika: 'Am I invisible to you?' 👻",
          "Half the job done is like half-cooked food! 🍝"
        ];
        showFeedback(getRandomFeedback(emptyRcFeedbacks), false);
        return;
      }

      if (!rsAnswer) {
        const emptyRsFeedbacks = [
          "Rajat is giving you the silent treatment now! 😤",
          "Rajat: 'Do I not exist in your world?' 🤨",
          "You remembered Radhika but forgot Rajat? Selective memory much? 🧠",
          "Rajat is probably doing push-ups waiting for your answer! 💪",
          "One answer without the other is like tea without sugar! ☕"
        ];
        showFeedback(getRandomFeedback(emptyRsFeedbacks), false);
        return;
      }

      const rcPossibleAnswers = correctAnswers[currentId]['rc'];
      const rsPossibleAnswers = correctAnswers[currentId]['rs'];

      let feedback = '';
      let isCorrect = false;

      // Check RC answer - exact match with sample answers
      const isRcCorrect = rcPossibleAnswers.some(correctAns =>
        isAnswerCorrect(rcAnswer, correctAns)
      );

      // Check RS answer - exact match with sample answers
      const isRsCorrect = rsPossibleAnswers.some(correctAns =>
        isAnswerCorrect(rsAnswer, correctAns)
      );

      if (isRcCorrect && isRsCorrect) {
        const bothCorrectFeedbacks = [
          "WHOA! You nailed both! Are you secretly stalking them? 🕵️‍♂️",
          "Perfect score! You're officially promoted to 'Best Friend Detective'! 🏆",
          "Both right?! Someone's been paying attention! I'm impressed! 👏",
          "Double bulls-eye! You're like Sherlock Holmes but funnier! 🔍",
          "Radhika and Rajat are doing a happy dance right now! 💃🕺",
          "Plot twist: You actually DO know them! Mind = blown! 🤯"
        ];
        feedback = getRandomFeedback(bothCorrectFeedbacks);
        isCorrect = true;
      } else if (isRcCorrect) {
        const rcOnlyFeedbacks = [
          "Radhika's happy, Rajat is crying! You're 50% detective, 50% guesser! 😂😢",
          "Good job on Radhika! But Rajat is questioning your friendship! 🤔",
          "Half-way there! Radhika approves, Rajat is doing sad face! 😊😞",
          "Radhika: 'Yay!' Rajat: 'Seriously?!' Drama alert! 🎭",
          "You know Radhika better than Rajat? Favoritism much? 😏",
          "One down, one disappointed! Radhika's treating, Rajat is sulking! 🍰😤"
        ];
        feedback = getRandomFeedback(rcOnlyFeedbacks);
        isCorrect = true;
      } else if (isRsCorrect) {
        const rsOnlyFeedbacks = [
          "Rajat is celebrating while Radhika is planning revenge! 😈🎉",
          "Good job on Rajat! But Radhika is giving you the stink eye! 👁️",
          "Rajat: 'I knew you loved me more!' Radhika: 'Excuse me?!' 💔",
          "Half points! Rajat is happy dancing, Radhika is stress eating! 💃🍫",
          "You got Rajat right but Radhika wrong? She's plotting something! 😠",
          "Rajat approves, Radhika just updated your contact name to 'Who? 📝"
        ];
        feedback = getRandomFeedback(rsOnlyFeedbacks);
        isCorrect = true;
      } else {
        const bothWrongFeedbacks = [
          "Epic fail! Both are laughing AT you, not WITH you! 😂😂",
          "Wrong on both counts! Are you sure you know them? 🙄",
          "Double miss! Even a blindfolded monkey would do better! 🙈",
          "Both wrong?! They're questioning if you're really their friend! 💭",
          "Strike out! Radhika and Rajat are planning an intervention! 🆘",
          "Nope and nope! Your detective license has been revoked! 🚫🔍",
          "Both answers wrong! Time for some friendship homework! 📚",
          "Wrong x2! They're probably changing their phone numbers! 📱",
          "Double disaster! Even Google would be disappointed! 💻😞",
          "Two swings, two misses! Baseball isn't your sport either! ⚾"
        ];
        feedback = getRandomFeedback(bothWrongFeedbacks);
        isCorrect = false;
      }

      showFeedback(feedback, isCorrect);

      // REMOVE this part:
      // setTimeout(() => {
      //   document.getElementById(currentId).classList.remove('active');
      //   if (nextId === 'rakhi') {
      //     showQuestion(nextId, 11);
      //   } else {
      //     let num = parseInt(nextId.replace('q', ''));
      //     showQuestion(nextId, num);
      //   }
      // }, 2500);
    }

    function normalizeAnswer(str) {
      return str
        .toLowerCase()
        .normalize("NFD") // handles accents/diacritics
        .replace(/[\u0300-\u036f]/g, '') // remove accent marks
        .replace(/[^a-z0-9]/gi, '') // remove all non-alphanumeric chars
        .trim();
    }

    function getLevenshteinDistance(a, b) {
      const matrix = Array.from({length: b.length + 1}, (_, i) =>
        Array.from({length: a.length + 1}, (_, j) =>
          i === 0 ? j : j === 0 ? i : 0
        )
      );

      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          if (b[i - 1] === a[j - 1]) {
            matrix[i][j] = matrix[i - 1][j - 1];
          } else {
            matrix[i][j] = Math.min(
              matrix[i - 1][j - 1] + 1,
              matrix[i][j - 1] + 1,
              matrix[i - 1][j] + 1
            );
          }
        }
      }

      return matrix[b.length][a.length];
    }

    function isAnswerCorrect(userInput, correctAnswer) {
      const a = normalizeAnswer(userInput);
      const b = normalizeAnswer(correctAnswer);

      if (!a || !b) return false;

      const distance = getLevenshteinDistance(a, b);
      const maxAllowedDistance = Math.floor(Math.max(a.length, b.length) * 0.25); // 25% of length

      return distance <= maxAllowedDistance;
    }

    function showFeedback(message, isCorrect) {
      feedbackPopup.innerHTML = message;
      feedbackPopup.className = isCorrect ? 'feedback-popup correct-feedback' : 'feedback-popup wrong-feedback';
      feedbackPopup.style.display = 'block';

      function hidePopup() {
        feedbackPopup.style.display = 'none';
        clearTimeout(timeoutId);
        document.removeEventListener('click', handleOutsideInteraction);
        document.removeEventListener('touchstart', handleOutsideInteraction);
        document.removeEventListener('keydown', handleKeyPress);
      }

      const handleOutsideInteraction = (event) => {
        if (!feedbackPopup.contains(event.target)) {
          hidePopup();
        }
      };

      const handleKeyPress = () => {
        hidePopup();
      };

      const timeoutId = setTimeout(hidePopup, 5000);
      
      setTimeout(() => {
        document.addEventListener('click', handleOutsideInteraction);
        document.addEventListener('touchstart', handleOutsideInteraction);
        document.addEventListener('keydown', handleKeyPress);
      }, 100); // 100ms is usually enough
    }

    function selectRakhi(person, el, rakhiName) {
      // Remove previous selection for this person
      const personSection = el.closest('.rakhi-section');
      const previousSelected = personSection.querySelector('img.selected');
      if (previousSelected) {
        previousSelected.classList.remove('selected');
      }

      // Add selection to current element
      el.classList.add('selected');

      selectedRakhis[person] = {
        element: el,
        name: rakhiName
      };

      // Visual feedback
      createSparkles(el);

      // Check if all three rakhis are selected
      //if (selectedRakhis.rc && selectedRakhis.rs && selectedRakhis.self) {
      // setTimeout(() => {
      //   showFinalResult();
      // }, 1000);
      //}
    }

    function forceContinue() {
      const roles = ['rc', 'rs', 'self'];

      roles.forEach(role => {
        if (!selectedRakhis[role]) {
          // Get first image from the corresponding section
          const section = document.querySelector(`.rakhi-section.${role}-rakhi`) || document.querySelector(`.rakhi-section.self-rakhi`);
          const imgs = section.querySelectorAll('img');
          const imgIndex = (role === 'self') ? 0 : 1;
          const selectImg = imgs[imgIndex];
          if (selectImg) {
            selectRakhi(role, selectImg, selectImg.src.split('/').pop().replace('.webp', ''));
          }
        }
      });

      // After auto-selecting, move to final slide
      showFinalResult();
    }

    function showFinalResult() {
      // Hide rakhi selection screen
      document.getElementById('rakhi').classList.remove('active');
      // document.getElementById('progressFill').style.display = 'none';

      // Determine the tying images
      let rcTyingImage = `../attached_assets/${selectedRakhis.rc.name}_tying.webp`;
      let rsTyingImage = `../attached_assets/${selectedRakhis.rs.name}_tying.webp`;
      let selfTyingImage = `../attached_assets/${selectedRakhis.self.name}_tying.webp`;

      // Set the content inside the final slide
      const finalSlide = document.getElementById('final-slide');
      finalSlide.innerHTML = `        
        <h3>❤️ चलो, अब सब अपनी-अपनी राखी बंधवा लेते हैं! ❤️</h3>        
        <div class="final-result">
          <div class="result-section rc-result">            
            <p style="color: #e91e63; font-weight: bold; margin-bottom: 0.05rem;">राधिका के लिए राखी</p>
            <img src="${selectedRakhis.rc.element.src}" />
            <div>
              <img src="${rcTyingImage}" class="tying-image" alt="Tying ${selectedRakhis.rc.name} for Radhika"/>
            </div>
            <p style="color: #e91e63; font-weight: bold;">अरे! कितनी प्यारी है! 💗</p>
          </div>
          <div class="result-section rs-result">            
            <p style="color: #e91e63; font-weight: bold; margin-bottom: 0.05rem;">रजत के लिए राखी</p>
            <img src="${selectedRakhis.rs.element.src}" />
            <div>
              <img src="${rsTyingImage}" class="tying-image" alt="Tying ${selectedRakhis.rs.name} for Rajat"/>
            </div>
            <p style="color: #2196f3; font-weight: bold;">क्या बात! ज़ोरदार!! 💙</p>
          </div>
        </div>
        <div class="final-result" style="justify-content: center; margin-top: 2rem;">
          <div class="result-section self-result">            
            <p style="color: #9c27b0; font-weight: bold; margin-bottom: 0.05rem;">तुम्हारे लिए राखी${userName ? ` (${userName})` : ''}</p>
            <img src="${selectedRakhis.self.element.src}" />
            <div>
              <img src="${selfTyingImage}" class="tying-image" alt="Tying ${selectedRakhis.self.name} for yourself"/>
            </div>
            <p id="waah-line" style="color: #9c27b0; font-weight: bold;">वाह जी! खुद के लिए तो सबसे बढ़िया वाली पसंद की है! 💜</p>
          </div>
        </div>
        <div style="text-align: center; margin-top: 2rem;">
          <p id="badhai-line" style="color: #e91e63; font-size: 1.4rem; font-weight: bold;">
            रक्षा बंधन की ढेर सारी बधाई! ✨
          </p>
          <p style="color: #8e24aa;">हमारा प्रेम इसी तरह बना रहे और बढ़ता रहे! 💛</p>
          <div id="photoReveal" style="text-align: center; margin-bottom: 3rem;">
            <img src="../attached_assets/Graphic_AA.png" 
                 alt="Our photo together" 
                 style="max-width: 90%; height: auto; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.3);">
          </div>
          <div style="text-align: center; margin-top: 2rem;">       
         
            <button class="music-btn" onclick="window.location.href='https://youtube.com/playlist?list=PLnOeAhpf-Q3v7tLc71CMAXnWKLgduAT8s&si=JmeNV8h_sv4lVYls'">Continue music on YouTube 🎵</button>
              
            <button class="reveal-btn" onclick="playAgain()">Try the Quiz Again! 🔄</button>

            <div id="revealConfirm1" style="margin-top: 1rem; text-align: center;">
              <button class="reveal-btn" onclick="showRevealConfirm2()">Reveal All Answers 🧐</button>
            </div>

            <div id="revealConfirm2" style="display: none; text-align: center;">
              <p>🙄 You sure you want to reveal the answers?</p>
              <button class="reveal-btn" onclick="showRevealConfirm3()">Yes</button>
              <button class="reveal-btn" onclick="cancelReveal()">No</button>
            </div>

            <div id="revealConfirm3" style="display: none; text-align: center;">
              <p>😤 Are you really sure that you want to spoil it?</p>
              <button class="reveal-btn" onclick="showRevealConfirm4()">Yes</button>
              <button class="reveal-btn" onclick="cancelReveal()">No</button>
            </div>
            
            <div id="revealConfirm4" style="display: none; text-align: center;">
              <p>😩 Enter the secret key to reveal the answers!</p>
              <input type="text" id="secretCodeInput" placeholder="Enter secret key..."
                style="margin-bottom: 0.5rem; font-size: 1.1rem; padding: 1rem 2rem; border: 3px solid #9c27b0; border-radius: 25px; background: linear-gradient(45deg, #fff, #fce4ec); display: inline-block;" />
              <button class="reveal-btn" onclick="
                const code = normalizeAnswer(document.getElementById('secretCodeInput').value.trim());
                if (code === 'jaoteeplo') {
                  document.getElementById('codeErrorMsg').style.display = 'none';
                  revealAnswersFinal();
                } else {
                  document.getElementById('codeErrorMsg').style.display = 'block';
                }
              ">Unlock Answers</button>              
              <p id="codeErrorMsg" style="color: red; display: none; margin-top: 1rem;">❌ Incorrect code. Try again.</p>
            </div>
          </div>
          <div id="finalAnswerReveal" style="display: none; margin-top: 2rem;"></div>
        </div>
      `;

      // Show the final slide
      finalSlide.classList.add('active');

      // Scroll to top of page
      window.scrollTo({top: 0, behavior: 'smooth'});

      // Optional: Initial confetti explosion on load
      setTimeout(() => {
        for (let i = 0; i < 50; i++) {
          setTimeout(() => createConfetti(), i * 100);
        }
      }, 1000); // Wait 1 second before starting the confetti bursts

      // Confetti when group photo scrolls into view — only once
      const photoSection = document.getElementById('photoReveal');
      let photoConfettiTriggered = false;

      if (photoSection) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting && !photoConfettiTriggered) {
              photoConfettiTriggered = true;
              for (let i = 0; i < 50; i++) {
                setTimeout(() => createConfettiFromLine(), i * 100);
              }
              observer.unobserve(photoSection);
            }
          });
        }, {
          threshold: 0.6
        });

        // Delay observing
        setTimeout(() => {
          observer.observe(photoSection);
        }, 500);
      }

      // Re-trigger confetti on general scroll with cooldown
      let confettiCooldown = false;
      window.addEventListener('scroll', () => {
        const finalSlide = document.getElementById('final-slide');
        if (
          finalSlide.classList.contains('active') &&
          !confettiCooldown &&
          window.scrollY > 50
        ) {
          confettiCooldown = true;
          createConfetti();
          createConfettiFromLine();
          setTimeout(() => {
            confettiCooldown = false;
          }, 1500); // 1.5s cooldown
        }
      });
    }

    function createConfetti() {
      const colors = ['#9c27b0', '#ff9800', '#8e24aa', '#ff7043', '#2196f3', '#e91e63'];
      for (let i = 0; i < 20; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.top = '0px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 2 + 's';
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 3000);
      }
    }

    function createConfettiFromLine() {
      const colors = ['#9c27b0', '#ff9800', '#8e24aa', '#ff7043', '#2196f3', '#e91e63'];
      setTimeout(() => {
        const waahLine = document.getElementById('waah-line');
        const startY = waahLine.getBoundingClientRect().bottom + window.scrollY - 0;
        for (let i = 0; i < 20; i++) {
          const confetti = document.createElement('div');
          confetti.className = 'confettiFromLine';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = `${startY}px`; // ✅ now startY is defined `${startY}px`
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 2 + 's';
          document.body.appendChild(confetti);

          setTimeout(() => confetti.remove(), 3000);
        }
      }, 1000);
    }

    function createSparkles(element) {
      const rect = element.getBoundingClientRect();
      for (let i = 0; i < 10; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = rect.left + Math.random() * rect.width + 'px';
        sparkle.style.top = rect.top + Math.random() * rect.height + 'px';
        document.body.appendChild(sparkle);

        setTimeout(() => sparkle.remove(), 2000);
      }
    }

    function createEmojiBurst(...emojis) {
      emojis.forEach((emoji, index) => {
        const burst = document.createElement('div');
        burst.className = 'emoji-burst';
        burst.innerHTML = emoji;
        burst.style.left = Math.random() * 100 + '%';
        burst.style.top = Math.random() * 50 + '%';
        burst.style.animationDelay = index * 0.2 + 's';
        document.body.appendChild(burst);

        setTimeout(() => burst.remove(), 2000);
      });
    }

    function skipToNext(currentId, nextId) {
      // Hide current question without checking answer
      document.getElementById(currentId).classList.remove('active');

      // Show next question
      if (nextId === 'rakhi') {
        showQuestion(nextId, 11);
      } else {
        let num = parseInt(nextId.replace('q', ''));
        showQuestion(nextId, num);
      }

      createEmojiBurst('⏭️', '💨', '🎯');
      // Scroll to top of question
      const progress_scroll = document.getElementById('progressFill');
      const startY_scroll = progress_scroll.getBoundingClientRect().top + window.scrollY - 0;
      window.scrollTo({top: startY_scroll, behavior: 'smooth'});
    }

    function skipToEnd() {
      // Hide current question
      document.querySelectorAll('.question.active').forEach(q => q.classList.remove('active'));

      // Show rakhi selection
      showQuestion('rakhi', 11);
      createEmojiBurst('🚀', '💨', '⚡');
      // Scroll to top of page
      window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function showRevealConfirm2() {
      document.getElementById('revealConfirm1').style.display = 'none';
      document.getElementById('revealConfirm2').style.display = 'block';
    }

    function showRevealConfirm3() {
      document.getElementById('revealConfirm2').style.display = 'none';
      document.getElementById('revealConfirm3').style.display = 'block';
    }

    function showRevealConfirm4() {
      document.getElementById('revealConfirm3').style.display = 'none';
      document.getElementById('revealConfirm4').style.display = 'block';
    }

    function cancelReveal() {
      document.getElementById('revealConfirm1').style.display = 'block';
      document.getElementById('revealConfirm2').style.display = 'none';
      document.getElementById('revealConfirm3').style.display = 'none';
      document.getElementById('revealConfirm4').style.display = 'none';
    }

    function revealAnswersFinal() {
      const finalContainer = document.getElementById('finalAnswerReveal');
      let answersHTML = '<div class="answers-list"><h3 style="text-align: center; color: #e91e63;">🎯 All Correct Answers! 🎯</h3>';

      Object.keys(correctAnswers).forEach(questionId => {
        const questionText = questionTexts[questionId];
        const rcAnswers = correctAnswers[questionId]['rc'];
        const rsAnswers = correctAnswers[questionId]['rs'];

        answersHTML += `
          <div class="answer-item">
            <h4>${questionText}</h4>
            <div class="dual-answers">
              <div class="answer-section rc-answers">
                <p><strong>Radhika:</strong> ${rcAnswers.join(', ')}</p>
              </div>
              <div class="answer-section rs-answers">
                <p><strong>Rajat:</strong> ${rsAnswers.join(', ')}</p>
              </div>
            </div>
          </div>
        `;
      });

      answersHTML += '</div>';
      finalContainer.innerHTML = answersHTML;
      finalContainer.style.display = 'block';

      // Hide confirm buttons
      document.getElementById('revealConfirm4').style.display = 'none';
    }

    function playAgain() {
      if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
      }
      // Restart the quiz
      document.getElementById('final-slide').classList.remove('active');
      quiz.style.display = 'none';
      document.getElementById('musicplayer').style.display = 'block';
      document.getElementById('startDramaBtn').style.display = 'block';
      // Scroll to top of page
      window.scrollTo({top: 0, behavior: 'smooth'});
      // Reset the quiz
      // location.reload();
    }

    // Auto-create ambient sparkles
    setInterval(() => {
      if (Math.random() > 0.7) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = Math.random() * 100 + '%';
        sparkle.style.top = Math.random() * 100 + '%';
        sparkle.style.animationDuration = (Math.random() * 2 + 1) + 's';
        document.body.appendChild(sparkle);

        setTimeout(() => sparkle.remove(), 2000);
      }
    }, 1000);

    function getRandomFeedback(feedbacks) {
      return feedbacks[Math.floor(Math.random() * feedbacks.length)];
    }
  </script>
</body>

</html>